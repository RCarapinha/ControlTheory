syms q theta1 theta2 u dq dtheta1 dtheta2 ddq ddtheta1 ddtheta2

eq1 = -(L1*M1 + L1*M2)*dtheta1^(2)*sin(theta1) ...
    - L2*M2*dtheta1*dtheta2*sin(theta1+theta2)...
    -L2*M2*dtheta2^(2)*sin(theta1+theta2) ...
    +(M+M1+M2)*ddq +(L1*M1+L1*M2)*ddtheta1*cos(theta1) ...
    +L2*M2*ddtheta2*cos(theta1+theta2) == u;

eq2 = -g*L1*(M1+M2)*sin(theta1) - g*L2*M2*sin(theta1+theta2) ...
    +L2*M2*dq*dtheta2*sin(theta1+theta2) - L1*L2*M2*dtheta2^(2)*sin(theta2) ...
    +(L1*M1+L1*M2) * ddq *cos(theta1) + L1^(2)*(M1+M2) *ddtheta1 ...
    +L1*L2*M2*ddtheta2 *cos(theta2) == 0;

eq3 = -g*L2*M2 *sin(theta1+theta2) - L2*M2*dq*dtheta1*sin(theta1+theta2)...
    +L2*M2*ddq*cos(theta1+theta2)+L1*L2*M2*ddtheta1*cos(theta2) + L2^(2)*M2*ddtheta2 == 0;

sol = solve(eq1,eq2,eq3, [ddq,ddtheta1,ddtheta2]);

ddq_raw = simplify(sol.ddq)
ddtheta1_raw = simplify(sol.ddtheta1)
ddtheta2_raw = simplify(sol.ddtheta2)
